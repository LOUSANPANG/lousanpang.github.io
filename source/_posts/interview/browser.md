---
title: 前端面试复习计划之浏览器
date: 2020-5-1
tags: 
    - 浏览器
categories: 面试
keywords: [面试]
description: 前端面试复习计划
top_img: # 除非特定需要，可以不写
comments: # 是否显示评论 除非设置false,可以不写
cover: https://s3.uuu.ovh/imgs/2022/12/01/747b6f3901a2bdcf.jpg # 缩略图
toc: # 章节目录 除非特定文章设置，可以不写
toc_number: # 是否显示toc数字 除非特定文章设置，可以不写
copyright: # 是否显示版权 除非特定文章设置，可以不写
---


## 浏览器渲染原理

### 从输入URL到页面加载的全过程

- 域名解析(本地DNS -> 根域服务器 -> 顶级域服务器 -> 所属域服务器 -> 解析IP)
  - 向 本地DNS服务器(三大运营商) 发起域名解析请求
  - 先查询其自身缓存纪录中是否存在对应的IP地址，有缓存直接返回缓存对应的IP地址信息
  - 没有缓存进一步向 根域名服务器(包含13个顶级域名服务器) 发起求助
  - 根域名服务器将告知本地服务器，该域名由.com顶级域名服务器管理，给出对应IP
  - 该顶级域名服务器告知本地服务器，该域名需要向所属的域服务器上查询，给出对应IP
  - 本地DNS服务器继续向 域服务器 发起域名解析请求，返回对应IP，并缓存域名对应IP地址对应关系记录
- DOM
  - 请求服务器得到HTML文件
  - 解析HTML文件：文件字节 -> 字符 -> 带其实标签的符号标签Token -> 节点对象 -> 最终构建文本对象模型DOM
- CSSOM
  - 构建DOM发现link标签 -> 向服务发送请求得到CSS文件
  - 解析CSS文件的同时，继续解析HTML文件
  - 解析CSS文件：字节 -> 字符 -> Token -> 节点 -> CSS对象模型CSSOM
- JS文件
  - 解析HTML文件时遇到script标签，请求JS文件
  - 有 async 属性为异步解析，不会阻塞HTML的解析
  - 如果JS文件比CSS文件解析快，默认要等CSSOM构建完成，因为JS会操作CSS样式
  - 如果JS代码有操作DOM和CSSOM，需要重新构建一次DOM、CSSOM
- 构建渲染树
  - 匹配DOM和CSSOM节点并且捕获可见内容
- 布局
  - 获取渲染树结构、节点位置和大小
- 绘制
  - 把渲染树以像素的形式绘制在页面



## 关于重绘、重排

### 重绘与重排区别

- 重排/回流（Reflow）：当DOM的变化影响了元素的几何信息，浏览器需要重新计算元素的几何属性，将其安放在界面中的正确位置，这个过程叫做重排。表现为重新生成布局，重新排列元素;
- 重绘(Repaint): 当一个元素的外观发生改变，但没有改变布局,重新把元素外观绘制出来的过程，叫做重绘。表现为某些元素的外观被改变;
- 单单改变元素的外观，肯定不会引起网页重新生成布局，但当浏览器完成重排之后，将会重新绘制受到此次重排影响的部分;
- 重排和重绘代价是高昂的，它们会破坏用户体验，并且让UI展示非常迟缓，而相比之下重排的性能影响更大，在两者无法避免的情况下，一般我们宁可选择代价更小的重绘;
- 重绘不一定会出现重排，重排必然会出现重绘;


### 如何触发重排和重绘

任何改变用来构建渲染树的信息都会导致一次重排或重绘：

- 添加、删除、更新DOM节点;
- 通过display: none隐藏一个DOM节点-触发重排和重绘;
- 通过visibility: hidden隐藏一个DOM节点-只触发重绘，因为没有几何变化;
- 移动或者给页面中的DOM节点添加动画;
- 添加一个样式表，调整样式属性;
- 用户行为，例如调整窗口大小，改变字号，或者滚动;


### 如何避免重绘或者重排

- 集中改变样式，不要一条一条地修改 DOM 的样式。
- 不要把 DOM 结点的属性值放在循环里当成循环里的变量。
- 为动画的 HTML 元件使用 fixed 或 absoult 的 position，那么修改他们的 CSS 是不会 reflow 的。
- 不使用 table 布局。因为可能很小的一个小改动会造成整个 table 的重新布局。
- 尽量只修改position：absolute或fixed元素，对其他元素影响不大
- 动画开始GPU加速，translate使用3D变化
- 提升为合成层,将元素提升为合成层有以下优点：
  - 合成层的位图，会交由 GPU 合成，比 CPU 处理要快;
  - 当需要 repaint 时，只需要 repaint 本身，不会影响到其他的层;
  - 对于 transform 和 opacity 效果，不会触发 layout 和 paint;

    ```css
    <!-- 提升合成层的最好方式是使用 CSS 的 will-change 属性： -->
    #target {
        will-change: transform;
    }
    ```
